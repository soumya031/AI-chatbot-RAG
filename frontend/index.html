<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DocMind — RAG Chatbot</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --ink:    #0d0d0d;
    --paper:  #f5f0e8;
    --cream:  #ede8dc;
    --accent: #c8522a;
    --muted:  #8a8070;
    --border: #d4cfc4;
    --code:   #e8e3d8;
    --shadow: rgba(13,13,13,0.08);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html, body { height: 100%; }
  body {
    font-family: 'DM Mono', monospace;
    background: var(--paper);
    color: var(--ink);
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* ── Header ── */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 28px;
    height: 60px;
    background: var(--ink);
    flex-shrink: 0;
    border-bottom: 2px solid var(--accent);
  }
  .logo {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    color: var(--paper);
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--accent); }
  .header-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .status-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: #555;
    transition: background 0.3s;
  }
  .status-dot.active { background: #4caf50; }

  /* ── Layout ── */
  .app {
    display: flex;
    flex: 1;
    overflow: hidden;
  }

  /* ── Sidebar ── */
  sidebar {
    width: 280px;
    min-width: 280px;
    background: var(--cream);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  .sidebar-header {
    padding: 20px 20px 12px;
    border-bottom: 1px solid var(--border);
  }
  .sidebar-title {
    font-size: 10px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
  }
  .upload-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    padding: 10px 14px;
    background: var(--ink);
    color: var(--paper);
    border: none;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    letter-spacing: 0.5px;
    transition: background 0.2s;
  }
  .upload-btn:hover { background: var(--accent); }
  .upload-btn svg { flex-shrink: 0; }
  #fileInput { display: none; }

  .docs-list {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }
  .doc-item {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    padding: 10px 12px;
    margin-bottom: 6px;
    background: var(--paper);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    animation: slideIn 0.2s ease;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateX(-8px); } to { opacity: 1; transform: translateX(0); } }
  .doc-info { flex: 1; min-width: 0; }
  .doc-name {
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--ink);
  }
  .doc-chunks { font-size: 10px; color: var(--muted); margin-top: 2px; }
  .doc-delete {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted);
    padding: 2px;
    display: flex;
    align-items: center;
    flex-shrink: 0;
    transition: color 0.2s;
    margin-left: 8px;
  }
  .doc-delete:hover { color: var(--accent); }
  .empty-docs {
    text-align: center;
    padding: 32px 16px;
    color: var(--muted);
    font-size: 12px;
    line-height: 1.8;
  }
  .empty-docs svg { opacity: 0.3; margin-bottom: 12px; }

  /* ── Chat Area ── */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 24px 28px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  .messages::-webkit-scrollbar { width: 4px; }
  .messages::-webkit-scrollbar-track { background: transparent; }
  .messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .welcome {
    max-width: 500px;
    margin: auto;
    text-align: center;
    padding: 48px 24px;
  }
  .welcome-icon {
    width: 64px; height: 64px;
    margin: 0 auto 20px;
    background: var(--ink);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 2px;
  }
  .welcome h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 28px;
    color: var(--ink);
    margin-bottom: 12px;
    letter-spacing: -0.5px;
  }
  .welcome p {
    font-size: 13px;
    color: var(--muted);
    line-height: 1.8;
  }
  .welcome-steps {
    margin-top: 24px;
    text-align: left;
    background: var(--cream);
    border: 1px solid var(--border);
    padding: 16px 20px;
  }
  .welcome-step {
    display: flex;
    gap: 12px;
    font-size: 12px;
    color: var(--ink);
    padding: 6px 0;
  }
  .step-num {
    width: 20px;
    height: 20px;
    background: var(--accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: 700;
    flex-shrink: 0;
    margin-top: 1px;
  }

  /* Messages */
  .message { display: flex; gap: 12px; max-width: 820px; }
  .message.user { flex-direction: row-reverse; align-self: flex-end; }
  .message.assistant { align-self: flex-start; }
  .avatar {
    width: 32px; height: 32px;
    border-radius: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
    letter-spacing: 0.5px;
  }
  .user .avatar   { background: var(--accent); color: white; }
  .assistant .avatar { background: var(--ink); color: var(--paper); }
  .bubble {
    padding: 12px 16px;
    font-size: 13px;
    line-height: 1.7;
    border-radius: 2px;
    max-width: 600px;
  }
  .user .bubble {
    background: var(--ink);
    color: var(--paper);
  }
  .assistant .bubble {
    background: white;
    border: 1px solid var(--border);
    color: var(--ink);
  }

  .sources {
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }
  .sources-label {
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .source-chip {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--code);
    border: 1px solid var(--border);
    padding: 3px 8px;
    font-size: 10px;
    color: var(--ink);
    margin: 2px 3px 2px 0;
    cursor: pointer;
    position: relative;
  }
  .source-chip:hover { border-color: var(--accent); }
  .source-score { color: var(--accent); font-weight: 500; }

  /* Tooltip */
  .tooltip-container { position: relative; display: inline-block; }
  .tooltip {
    display: none;
    position: absolute;
    bottom: calc(100% + 6px);
    left: 0;
    background: var(--ink);
    color: var(--paper);
    font-size: 11px;
    padding: 10px 14px;
    width: 280px;
    line-height: 1.5;
    z-index: 100;
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  }
  .tooltip-container:hover .tooltip { display: block; }

  /* Thinking indicator */
  .thinking {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 16px;
    background: white;
    border: 1px solid var(--border);
    max-width: 140px;
    font-size: 12px;
    color: var(--muted);
  }
  .thinking-dots { display: flex; gap: 4px; }
  .thinking-dot {
    width: 5px; height: 5px;
    background: var(--muted);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }
  .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
  .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
    40% { transform: translateY(-6px); opacity: 1; }
  }

  /* ── Input ── */
  .input-area {
    padding: 16px 28px 20px;
    border-top: 1px solid var(--border);
    background: var(--paper);
  }
  .input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }
  textarea {
    flex: 1;
    padding: 12px 14px;
    font-family: 'DM Mono', monospace;
    font-size: 13px;
    color: var(--ink);
    background: white;
    border: 1px solid var(--border);
    border-radius: 2px;
    resize: none;
    outline: none;
    min-height: 46px;
    max-height: 120px;
    line-height: 1.5;
    transition: border-color 0.2s;
  }
  textarea:focus { border-color: var(--ink); }
  textarea::placeholder { color: var(--muted); }
  .send-btn {
    width: 46px; height: 46px;
    background: var(--ink);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--paper);
    flex-shrink: 0;
    transition: background 0.2s;
  }
  .send-btn:hover { background: var(--accent); }
  .send-btn:disabled { background: var(--border); cursor: not-allowed; }
  .input-hint {
    margin-top: 6px;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.3px;
  }

  /* Upload overlay */
  .upload-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(13,13,13,0.7);
    z-index: 200;
    align-items: center;
    justify-content: center;
  }
  .upload-overlay.visible { display: flex; }
  .upload-modal {
    background: var(--paper);
    border: 2px solid var(--accent);
    padding: 32px 36px;
    max-width: 360px;
    width: 90%;
    text-align: center;
  }
  .upload-modal h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 20px;
    margin-bottom: 8px;
  }
  .upload-modal p { font-size: 12px; color: var(--muted); margin-bottom: 20px; }
  .drop-zone {
    border: 2px dashed var(--border);
    padding: 32px 20px;
    cursor: pointer;
    transition: border-color 0.2s;
    margin-bottom: 16px;
  }
  .drop-zone:hover, .drop-zone.drag-over { border-color: var(--accent); }
  .drop-zone p { font-size: 12px; color: var(--muted); margin-top: 8px; }
  .upload-progress {
    display: none;
    background: var(--cream);
    border: 1px solid var(--border);
    padding: 12px;
    font-size: 12px;
    color: var(--muted);
    text-align: center;
    margin-bottom: 12px;
  }
  .upload-progress.visible { display: block; }
  .modal-close {
    background: none;
    border: 1px solid var(--border);
    padding: 8px 20px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  .modal-close:hover { border-color: var(--ink); color: var(--ink); }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--ink);
    color: var(--paper);
    padding: 12px 20px;
    font-size: 12px;
    z-index: 300;
    opacity: 0;
    transform: translateY(8px);
    transition: all 0.25s;
    max-width: 320px;
  }
  .toast.show { opacity: 1; transform: translateY(0); }
  .toast.error { background: var(--accent); }
</style>
</head>
<body>

<header>
  <div class="logo">Doc<span>Mind</span></div>
  <div class="header-status">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Loading...</span>
  </div>
</header>

<div class="app">
  <sidebar>
    <div class="sidebar-header">
      <div class="sidebar-title">Knowledge Base</div>
      <button class="upload-btn" onclick="openUploadModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
        Upload Document
      </button>
    </div>
    <div class="docs-list" id="docsList">
      <div class="empty-docs">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:block;margin:0 auto 12px">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
        </svg>
        No documents yet.<br>Upload .txt, .md, .pdf or .json files to begin.
      </div>
    </div>
  </sidebar>

  <div class="chat-area">
    <div class="messages" id="messages">
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#f5f0e8" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><path d="M11 8v6M8 11h6" stroke-width="2"/>
          </svg>
        </div>
        <h1>Ask your documents</h1>
        <p>Upload domain-specific documents, then ask questions. Answers are strictly grounded in your content — no hallucinations.</p>
        <div class="welcome-steps">
          <div class="welcome-step"><div class="step-num">1</div><div>Upload documents using the sidebar</div></div>
          <div class="welcome-step"><div class="step-num">2</div><div>Type your question below</div></div>
          <div class="welcome-step"><div class="step-num">3</div><div>Get answers with source citations</div></div>
        </div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-row">
        <textarea id="queryInput" placeholder="Ask a question about your documents..." rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
        </button>
      </div>
      <div class="input-hint">Press Enter to send · Shift+Enter for new line</div>
    </div>
  </div>
</div>

<!-- Upload Modal -->
<div class="upload-overlay" id="uploadOverlay" onclick="handleOverlayClick(event)">
  <div class="upload-modal">
    <h2>Add Document</h2>
    <p>Supported formats: .txt · .md · .pdf · .json</p>
    <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileInput').click()"
         ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#8a8070" stroke-width="1.5" style="margin:0 auto">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
      <p>Click to browse or drag & drop here</p>
    </div>
    <div class="upload-progress" id="uploadProgress">Uploading and indexing...</div>
    <input type="file" id="fileInput" accept=".txt,.md,.pdf,.json" onchange="uploadFile(event)">
    <button class="modal-close" onclick="closeUploadModal()">Close</button>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
const API = '';  // same origin
let sessionId = null;

// ── Init ──────────────────────────────────────────────────────────────────────
async function init() {
  try {
    const r = await fetch(`${API}/api/status`);
    const data = await r.json();
    document.getElementById('statusDot').classList.add('active');
    document.getElementById('statusText').textContent = `${data.total_chunks} chunks · ${data.llm_provider}`;
    await loadDocuments();
  } catch {
    document.getElementById('statusText').textContent = 'Backend offline';
    showToast('Cannot connect to backend. Is it running?', true);
  }
}

// ── Documents ─────────────────────────────────────────────────────────────────
async function loadDocuments() {
  try {
    const r = await fetch(`${API}/api/documents`);
    const data = await r.json();
    renderDocuments(data.documents);
  } catch {}
}

function renderDocuments(docs) {
  const list = document.getElementById('docsList');
  if (!docs || docs.length === 0) {
    list.innerHTML = `<div class="empty-docs">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display:block;margin:0 auto 12px"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      No documents yet.<br>Upload .txt, .md, .pdf or .json files to begin.</div>`;
    return;
  }
  list.innerHTML = docs.map(d => `
    <div class="doc-item">
      <div class="doc-info">
        <div class="doc-name" title="${d.name}">${d.name}</div>
        <div class="doc-chunks">${d.chunks} chunks</div>
      </div>
      <button class="doc-delete" onclick="deleteDoc('${d.name}')" title="Remove">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
          <path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/>
        </svg>
      </button>
    </div>`).join('');
}

async function deleteDoc(name) {
  if (!confirm(`Remove "${name}" from the knowledge base?`)) return;
  try {
    const r = await fetch(`${API}/api/documents/${encodeURIComponent(name)}`, { method: 'DELETE' });
    if (r.ok) { showToast(`Removed "${name}"`); await loadDocuments(); await updateStatus(); }
  } catch { showToast('Failed to remove document', true); }
}

// ── Upload ────────────────────────────────────────────────────────────────────
function openUploadModal()  { document.getElementById('uploadOverlay').classList.add('visible'); }
function closeUploadModal() { document.getElementById('uploadOverlay').classList.remove('visible'); document.getElementById('uploadProgress').classList.remove('visible'); }
function handleOverlayClick(e) { if (e.target === document.getElementById('uploadOverlay')) closeUploadModal(); }

function handleDragOver(e)  { e.preventDefault(); document.getElementById('dropZone').classList.add('drag-over'); }
function handleDragLeave(e) { document.getElementById('dropZone').classList.remove('drag-over'); }
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('dropZone').classList.remove('drag-over');
  const file = e.dataTransfer.files[0];
  if (file) uploadFileObj(file);
}

async function uploadFile(e) { const f = e.target.files[0]; if (f) await uploadFileObj(f); }

async function uploadFileObj(file) {
  const prog = document.getElementById('uploadProgress');
  prog.textContent = `Indexing "${file.name}"...`;
  prog.classList.add('visible');

  const formData = new FormData();
  formData.append('file', file);

  try {
    const r = await fetch(`${API}/api/documents/upload`, { method: 'POST', body: formData });
    const data = await r.json();
    if (r.ok) {
      showToast(`✓ ${data.chunks_added} chunks indexed from "${file.name}"`);
      await loadDocuments();
      await updateStatus();
      setTimeout(closeUploadModal, 800);
    } else {
      showToast(data.detail || 'Upload failed', true);
    }
  } catch (err) {
    showToast('Upload error: ' + err.message, true);
  } finally {
    prog.classList.remove('visible');
    document.getElementById('fileInput').value = '';
  }
}

// ── Chat ──────────────────────────────────────────────────────────────────────
function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

async function sendMessage() {
  const input = document.getElementById('queryInput');
  const msg = input.value.trim();
  if (!msg) return;

  // Hide welcome screen
  document.getElementById('welcomeScreen')?.remove();

  input.value = '';
  input.style.height = 'auto';
  document.getElementById('sendBtn').disabled = true;

  appendMessage('user', msg);
  const thinking = appendThinking();

  try {
    const r = await fetch(`${API}/api/chat`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg, session_id: sessionId })
    });
    const data = await r.json();
    thinking.remove();

    if (r.ok) {
      sessionId = data.session_id;
      appendAssistantMessage(data.answer, data.sources);
    } else {
      appendAssistantMessage(`Error: ${data.detail}`, []);
    }
  } catch (err) {
    thinking.remove();
    appendAssistantMessage(`Connection error: ${err.message}`, []);
  }

  document.getElementById('sendBtn').disabled = false;
  input.focus();
}

function appendMessage(role, text) {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = `message ${role}`;
  div.innerHTML = `
    <div class="avatar">${role === 'user' ? 'YOU' : 'AI'}</div>
    <div class="bubble">${escapeHtml(text)}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function appendAssistantMessage(text, sources) {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'message assistant';

  let sourcesHtml = '';
  if (sources && sources.length > 0) {
    const chips = sources.map((s, i) => `
      <div class="tooltip-container">
        <div class="source-chip">
          <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
          ${escapeHtml(s.doc_name)}
          <span class="source-score">${(s.score * 100).toFixed(0)}%</span>
        </div>
        <div class="tooltip">${escapeHtml(s.preview)}</div>
      </div>`).join('');
    sourcesHtml = `<div class="sources"><div class="sources-label">Sources</div>${chips}</div>`;
  }

  div.innerHTML = `
    <div class="avatar">AI</div>
    <div class="bubble">${formatText(text)}${sourcesHtml}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function appendThinking() {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'message assistant';
  div.innerHTML = `<div class="avatar">AI</div>
    <div class="thinking"><div class="thinking-dots">
      <div class="thinking-dot"></div><div class="thinking-dot"></div><div class="thinking-dot"></div>
    </div></div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  return div;
}

// ── Helpers ───────────────────────────────────────────────────────────────────
function escapeHtml(s) {
  return (s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function formatText(text) {
  return escapeHtml(text)
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/`(.+?)`/g, '<code style="background:var(--code);padding:1px 4px;font-size:12px">$1</code>')
    .replace(/\n/g, '<br>');
}

function showToast(msg, isError = false) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.className = 'toast show' + (isError ? ' error' : '');
  setTimeout(() => toast.className = 'toast', 3500);
}

async function updateStatus() {
  try {
    const r = await fetch(`${API}/api/status`);
    const data = await r.json();
    document.getElementById('statusText').textContent = `${data.total_chunks} chunks · ${data.llm_provider}`;
  } catch {}
}

init();
</script>
</body>
</html>
